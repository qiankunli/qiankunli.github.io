---

layout: post
title: 《阿里巴巴云原生实践15讲》笔记
category: 技术
tags: Kubernetes
keywords: kubernetes cni

---

## 简介（持续更新）

* TOC
{:toc}

当我们回顾云计算的发展历程，会看到**基础架构**经历了从物理机到虚拟机，从虚 拟机再到容器的演进过程。在这大势之下，**应用架构**也在同步演进，从单体过渡到多层，再到当下的微服务。在变化的背后，有一股持续的动力，它来自于三个不变的追求:提高资源利用率，优化开发运维体验，以及更好地支持业务发展。

## Kubernetes的价值

![](/public/upload/kubernetes/application_delivery.jpg)

docker 让镜像和容器融合在一起，`docker run` 扣动扳机，实现镜像到 容器的转变。但`docker run` 仍然有太多要表述的，比如`docker run`的各种参数： 资源、网络、存储等，“一个容器一个服务”本身也不够反应应用的复杂性（或者 说还需要额外的信息 描述容器之间的关系，比如`--link`）。

我们学习linux的时候，知道linux 提供了一种抽象：一切皆文件。没有人会质疑基本单元为何是文件不是磁盘块？linux 还提供了一种抽象叫“进程”，没有人会好奇为何 linux 不让你直接操纵cpu 和 内存。一个复杂的系统，最终会在某个层面收敛起来，就好像一个web系统，搞到最后就是一系列object 的crud。类似的，如果我们要实现一个“集群操作系统”，容器的粒度未免太小。也就是说，镜像和容器之间仍然有鸿沟要去填平？kubernetes 叫pod，marathon叫Application，中文名统一叫“应用”。在这里，应用是一组容器的有机组 合，同时也包括了应用运行所需的网络、存储的需求的描述。而像这样一个“描述” 应用的 YAML 文件，放在 etcd 里存起来，然后通过控制器模型驱动整个基础设施的 状态不断地向用户声明的状态逼近，就是 Kubernetes 的核心工作原理了。“有了 Pod 和容 器设计模式，我们的**应用基础设施才能够与应用(而不是容器)进行交互和响应的能力**，实现了“云”与“应用”的直接对接。而有了声明式 API，我们的应用基础而设 施才能真正同下层资源、调度、编排、网络、存储等云的细节与逻辑解耦”。PS：笔者最近在团队管理上也有一些困惑， 其实，你直接告诉小伙伴怎么做并不是一个很好的方式，他们不自由，你也很心累。比较好的方式是做好目标管理，由他们自己不断去填平目标与现实的鸿沟。

## Kubernetes 落地思路

阿里巴巴落地 Kubernetes 可以分为三个阶段:

1. 首先**通过 Kubernetes 提供资源 供给**，但是不过多干扰运维流程，这系统容器是富容器，将镜像标准化与轻量级虚拟 化能力带给了上面的 PaaS 平台。
2. 通过 Kubernetes controller 的形式改造PaaS 平台的运维流程，给 PaaS 带来更强的**面向终态**的自动化能力。
3. 把运行 环境等传统重模式改成原生容器与 pod 的轻量模式，同时将 PaaS 能力完全移交给 Kubernetes controller，从而形成一个完全云原生的架构体系。

## 云原生技术架构演进中的挑战

1. Kubernetes 本身的管理，节点发布回滚策略，按规则要求灰度发布;将环境进行镜像切分，分为模拟环境和生产环境;并且在监控侧下足功夫，将 Kubernetes 变得更白盒化和透明化，及早发现问题、预防问题、解决问题。
2.  Kubernetes 的多租户管理

    ![](/public/upload/kubernetes/kubernetes_multi_tenancy.png)

在web级集群中动态调整Pod资源限制 https://github.com/openkruise
大规模k8s集群下的巡检 k8s集群运维通过巡检走向AIOPS

## Serverless

相 比容器技术，Serverless 可以将资源管理的粒度更加细化，使开发者更快上手云原 生，并且倡导事件驱动模型支持业务发展。从而帮助用户解决了资源管理复杂、低频业务资源占用等问题;实现**面向资源使用**，以取代**面向资源分配**的模式。

## 向阿里学习什么？

1. 一切问题 都可以变着法儿用技术问题去解决。
2. 就一个故障恢复，想不透的只能空口抱怨，若是想透了， 拉一个部门这个活儿都干不完。

![](/public/upload/kubernetes/fault_analysis_handle.png)